<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Homeware</title>

		<script type="text/javascript" src="lib/jquery.min.js"></script>
		<style type="text/css">
${demo.css}
		</style>
		<script type="text/javascript">
$(function () {

	pir_data = [];

	env_data_temp1w = [];
	env_data_bmp085_temp = [];
	env_data_bmp085_pres = [];
	env_data_dht22_temp = [];
	env_data_dht22_hum = [];
	
	w_data_obs_temp = [];
	w_data_obs_hum = [];

	$.getJSON("pir_data.json", 
		function(data)
		{
			for (i in data.pir_data) 
			{
				pir_data.push(
					[new Date(data.pir_data[i][2]).getTime(),
							  parseInt(data.pir_data[i][1])]
				);
			}

			makeChart();
		});

	$.getJSON("w_data_obs.json",
		function(data_)
		{
			data = data_.w_data_obs
			for (i in data.w_data_obs_temp)
			{
				w_data_obs_temp.push(
					[new Date(data.w_data_obs_temp[i][2]).getTime(),
						parseFloat(data.w_data_obs_temp[i][1])]
				);
			}
			for (i in data.w_data_obs_hum)
			{
				w_data_obs_hum.push(
					[new Date(data.w_data_obs_hum[i][2]).getTime(),
						parseFloat(data.w_data_obs_hum[i][1])]
				);
			}
	
		});

	$.getJSON("env_data.json", 
		function(data_)
		{

			data = data_.env_data

			for (i in data.env_data_temp1w) 
			{
				env_data_temp1w.push(
					[new Date(data.env_data_temp1w[i][2]).getTime(),
							  parseFloat(data.env_data_temp1w[i][1])]
				);
			}
			for (i in data.env_data_bmp085_temp) 
			{
				env_data_bmp085_temp.push(
					[new Date(data.env_data_bmp085_temp[i][2]).getTime(),
							  parseFloat(data.env_data_bmp085_temp[i][1])]
				);
			}
			for (i in data.env_data_bmp085_pres) 
			{
				env_data_bmp085_pres.push(
					[new Date(data.env_data_bmp085_pres[i][2]).getTime(),
							  parseFloat(data.env_data_bmp085_pres[i][1] / 100)]
				);
			}

			for (i in data.env_data_dht22_temp)
			{
				env_data_dht22_temp.push(
					[new Date(data.env_data_dht22_temp[i][2]).getTime(),
							  parseFloat(data.env_data_dht22_temp[i][1])]
				);

			}
			for (i in data.env_data_dht22_hum)
			{
				env_data_dht22_hum.push(
					[new Date(data.env_data_dht22_hum[i][2]).getTime(),
							  parseFloat(data.env_data_dht22_hum[i][1])]
				);

			}

			makeChart();
		});

	function makeChart()
	{	

	   Highcharts.setOptions({
    	    global: {
				timezoneOffset: 1 * 60,
	            useUTC: false
    	    }
	    });
		$('#container').highcharts({
			scrollbar: {
	            enabled: true
			},
			chart: {
				zoomType: 'x'
			},
			title: {
				text: 'Sensor data (last 7 days)'
			},
			xAxis: [{
				type: 'datetime',
				title: {
					text: 'Date'
				},
			}],
			yAxis: [{
				labels: {
					format: '{value}°C'
				},
				title: {
					text: 'Temperature'
				},
				opposite: true
			}, 
			{
				title: {
					text: 'Pressure'
				},
				labels: {
					format: '{value} mb'
				}
			},
			{
				title: {
					text: 'Movement (PIR triggers)'
				},
				type: 'logarithmic',
                max: 9999,
				min: 1
			},
			{
				title: {
					text: 'Rel. humidity'
				},
				labels: {
					format: '{value}%'
				},
				max: 100,
				min: 0
			}],
			series: [{
				name: 'Temp. (of RPi)',
				data: env_data_temp1w,
				type: 'spline',
				visible: false,
				tooltip: {
					valueSuffix: '°C'
				},
				yAxis: 0
			},
			
			{
				name: 'Temp (inside piano)',
				data: env_data_dht22_temp,
				type: 'spline',
				tooltip: {
					valueSuffix: '°C'
				},
				yAxis: 0
			},	
			{
				name: 'Rel. humidity (in piano)',
				data: env_data_dht22_hum,
				type: 'spline',
				tooltip: {
					valueSuffix: '%'
				},
				yAxis: 3
			},	
			{
				name: 'Temp. (Met Office)',
				data: w_data_obs_temp,
				type: 'spline',
				tooltip: {
					valueSuffix: '°C'
				},
				yAxis: 0
			},	
			{
				name: 'Rel. humidity (Met Office)',
				data: w_data_obs_hum,
				type: 'spline',
				tooltip: {
					valueSuffix: '%'
				},
				yAxis: 3
			},	
			{
				name: 'Temp. (kitchen)',
				data: env_data_bmp085_temp,
				type: 'spline',
				tooltip: {
					valueSuffix: '°C'
				},
				yAxis: 0
			},	
			{
				name: 'Pressure (kitchen)',
				data: env_data_bmp085_pres,
				yAxis: 1,
				type: 'spline',
				tooltip: {
					valueSuffix: ' mb'
				},
			},
			{
				name: 'Movement (kitchen)',
				data: pir_data,
				yAxis: 2,
				type: 'column',
				pointRange: 5 * 60 * 1000
		    }],

			scrollbar: {
                enabled: true,
                barBackgroundColor: 'gray',
                barBorderRadius: 7,
                barBorderWidth: 0,
                buttonBackgroundColor: 'gray',
                buttonBorderWidth: 0,
                buttonArrowColor: 'yellow',
                buttonBorderRadius: 7,
                rifleColor: 'yellow',
                trackBackgroundColor: 'white',
                trackBorderWidth: 1,
                trackBorderColor: 'silver',
                trackBorderRadius: 7
            }
		
		});
	}

});

		</script>
	</head>
	<body>
<script src="lib/highcharts.js"></script>
<script src="lib/exporting.js"></script>

<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<div> 
CSV:
<ul><li><a href="env_data_bmp085.csv">env_data_bmp085.csv</a>
<li><a href="env_data_pir.csv">env_data_pir.csv</a>
<li><a href="env_data_temp1w.csv">env_data_temp1w.csv</a>
</ul>
</div>

<div>
LATEST:
<ul><li>Motion
<li>Temperature
<li>Pressure
</ul>
</div>

	</body>
</html>
